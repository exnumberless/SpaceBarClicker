<meta name="viewport" content="width=device-width, initial-scale=1" />


<style>
    * {
        border: 1px dashed red
    }

    body {
        font-family: Verdana, Geneva, Tahoma, sans-serif;
    }

    main {
        display: flex;
        flex-direction: column;
        justify-content: start;
        align-items: center;
        height: 100%;
    }

    .space-bar-container {
        height: 200px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        width: 100%;
    }

    .space-bar {
        color: white;
        text-decoration: underline;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 40px;
        width: 90vw;
        height: 80px;
        background: linear-gradient(-0.5deg, gray, black 30%, gray);
        border-radius: 40px;
        user-select: none;
    }

    .space-bar.up {
        background: linear-gradient(-0.5deg, gray, black 30%, gray);
    }

    .space-bar.down {
        width: 81vw;
        height: 9vh;
        min-height: 68px;
        font-size: 36px;
        background: linear-gradient(-0.5deg, gray, black 30%, 25% darkgray, black);
    }
</style>

<main>
    <h1 class="score">X</h1>
    <div class="space-bar-container">
        <div class="space-bar up">SPACEBAR</div>
    </div>
    <h2 class="achievements">Achievements</h2>
</main>

<script>
    window.globalState = {
        score: 0,
    }


    function stateCallBack(newGameState = null, message = null) {
        console.log(`Message :: ${message}`);
        Object.assign(window.globalState, newGameState);
        const stateChangeEvent = new Event("gameStateChanged");
        document.dispatchEvent(stateChangeEvent);
    }

    function updateScore() {
        const score = window.globalState.score
        elements = Array.from(document.querySelectorAll('.score'));
        for (e of elements) {
            e.innerText = score
        }
    }

    function toggleSpaceButtonUp() {
        elements = Array.from(document.querySelectorAll('.space-bar'));
        for (e of elements) {
            e.classList.add('up');
            e.classList.remove('down');
        }
    }

    function toggleSpaceButtonDown() {
        elements = Array.from(document.querySelectorAll('.space-bar'));
        for (e of elements) {
            e.classList.add('down');
            e.classList.remove('up');
        }
    }

    spaceEventTargets = Array.from(document.querySelectorAll('.space-bar'));

    ['keydown', 'mousedown'].forEach(
        (eventType) => document.addEventListener(eventType, (event) => {
            if (eventType == 'mousedown' && spaceEventTargets.includes(event.target)) {
                down_state = true;
                stateCallBack({ score: window.globalState.score + 1 }, "Space down.");
                updateScore();
                toggleSpaceButtonDown();
            }
            if (eventType == 'keydown' && event.key == " " && !event.repeat) {
                down_state = true;
                stateCallBack({ score: window.globalState.score + 1 }, "Space down.");
                updateScore();
                toggleSpaceButtonDown();
            }
        })
    );

    ['keyup', 'mouseup'].forEach(
        (eventType) => document.addEventListener(eventType, (event) => {
            toggleSpaceButtonUp();
        })
    );
</script>